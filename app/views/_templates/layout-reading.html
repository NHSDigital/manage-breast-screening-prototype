{# app/views/_templates/layout-reading.html #}
{# Layout for reading pages - extends layout-app with reading-specific features #}

{% extends "layout-app.html" %}

{% set gridColumn = gridColumn or "nhsuk-grid-column-full" %}

{# Workflow mode adds status bar and workflow navigation #}
{# {% if isReadingWorkflow %}
  {% set mainClasses = "nhsuk-u-padding-top-3" %}
{% endif %} #}

{% block head %}
  {{ super() }}

  {# Meta tags for PACS viewer - only in workflow mode with participant #}
  {% if isReadingWorkflow and participant %}
    {% set mammogramImages = getImagesForEvent(eventId, "diagrams") %}
    {% set mammogramViews = event.mammogramData.views if event and event.mammogramData else {} %}
    <meta name="mammogram-event-id" content="{{ eventId }}">
    <meta name="mammogram-participant-name" content="{{ participant | getFullName }}">
    <meta name="mammogram-nhs-number" content="{{ participant.nhsNumber }}">
    <meta name="mammogram-sx-number" content="{{ participant.sxNumber }}">
    <meta name="mammogram-auto-open" content="{{ 'true' if data.settings.reading.autoOpenPacsViewer | falsify else 'false' }}">
    {% if mammogramImages and mammogramImages.paths %}
      {# Pass image paths - empty string if view is missing from mammogram data #}
      <meta name="mammogram-image-rcc" content="{{ mammogramImages.paths.rcc if mammogramViews.rightCraniocaudal else '' }}">
      <meta name="mammogram-image-lcc" content="{{ mammogramImages.paths.lcc if mammogramViews.leftCraniocaudal else '' }}">
      <meta name="mammogram-image-rmlo" content="{{ mammogramImages.paths.rmlo if mammogramViews.rightMediolateralOblique else '' }}">
      <meta name="mammogram-image-lmlo" content="{{ mammogramImages.paths.lmlo if mammogramViews.leftMediolateralOblique else '' }}">
    {% endif %}
  {% endif %}
{% endblock head %}

{% block header %}
  {{ super() }}

  {# Reading-specific debug logging #}
  {% if isReadingWorkflow %}
    {{ data.imageReadingTemp | log("imageReadingTemp") }}
  {% endif %}
  {% if batchId %}
    {{ batch | log("Batch") }}
  {% endif %}


  {# Show status bar only in workflow mode #}
  {% if isReadingWorkflow %}
    {% include "_includes/reading/reading-status-bar.njk" %}
  {% endif %}
{% endblock header %}

{% block beforeContent %}
  {% if isReadingWorkflow and showWorkflowNav %}
    {# Workflow navigation: prev/next case - only on main opinion page #}
    {% include "_includes/reading/workflow-navigation.njk" %}
  {% else %}
    {# Standard back link - can be hidden or customised per page #}
    {% if not hideBackLink %}
      {{ backLink({
        href: back.href or "javascript:history.back();",
        text: back.text or "Back"
      }) }}
    {% endif %}
  {% endif %}
{% endblock %}

{% block pageNavigation %}
  {# Override this block in pages that need custom navigation #}
{% endblock pageNavigation %}

