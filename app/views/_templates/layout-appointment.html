{# app/views/_templates/layout-appointment.html #}
{% extends 'layout-app.html' %}

{# Pages with navigation need full width, pages without use default or custom width #}
{% if showNavigation %}
  {% set gridColumn = "nhsuk-grid-column-full" %}
{% else %}
  {% set gridColumn = gridColumn or "nhsuk-grid-column-two-thirds" %}
{% endif %}

{# Wider page for workflow mode with side nav #}
{% if isAppointmentWorkflow and showNavigation %}
  {# {% set containerClasses = "nhsuk-width-container nhsuk-width-container--wide" %} #}
  {% set bodyClasses = (bodyClasses or "") + " app-workflow-mode" %}
{% endif %}

{# Pages set these variables to control behaviour #}
{% set showNavigation = showNavigation if showNavigation != undefined else false %}
{% set showPageHeading = showPageHeading if showPageHeading != undefined else true %}
{% set activeTab = activeTab or "" %}
{% set activeWorkflowStep = activeWorkflowStep or "" %}

{# Set referrerChain to current URL for change links #}
{% set referrerChain = referrerChain or currentUrl %}

{# Set back link for tab view mode (unless explicitly overridden) #}
{% if showNavigation and not isAppointmentWorkflow and not back %}
  {% set back = {
    href: "/clinics/" + clinicId,
    text: "Back to clinic"
  } %}
{% endif %}

{% block header %}
  {# Parent header with navigation #}
  {{ super() }}
  
  {# Appointment status bar - full width #}
  {% if isAppointmentWorkflow %}
    {% include "_includes/appointment-status-bar.njk" %}
    {# <is-sticky class="app-appointment-header app-appointment-header--sticky">
      <div class="nhsuk-width-container">
        {% include "_includes/workflow/workflow-top-nav.njk" %}
      </div>
    </is-sticky> #}
  {% endif %}
{% endblock %}

{% block pageNavigation %}
  {# View mode: appointment header with tabs (outside main form) #}
  {% if showNavigation and not isAppointmentWorkflow %}
    {% include "_includes/appointment/appointment-header.njk" %}
  {% endif %}
{% endblock %}

{% block pageContent %}

  {# Capture the content block once #}
  {% set appointmentContentHtml %}
    {% block appointmentContent %}{% endblock %}
  {% endset %}
  
  {# Pages with navigation show either workflow side nav or tabs #}
  {% if showNavigation %}
    
    {% if isAppointmentWorkflow %}
      {# Workflow mode: side navigation layout #}

      <div class="app-workflow-container">
        <div class="nhsuk-grid-row">
          <div class="nhsuk-grid-column-one-quarter">
            {% include '_includes/workflow/workflow-side-navigation.njk' %}
          </div>
          <div class="nhsuk-grid-column-three-quarters">
            {% if showPageHeading %}
              <h1>{{ pageHeading }}</h1>
            {% endif %}
            {{ appointmentContentHtml | safe }}
          </div>
        </div>
      </div>

    {% else %}
      {# View mode: tabs already shown in pageNavigation block #}
      {{ appointmentContentHtml | safe }}
      
    {% endif %}
    
  {% else %}
    {# Pages without navigation: render content directly (pages should include their own H1) #}
    {{ appointmentContentHtml | safe }}
    
  {% endif %}
{% endblock %}