{# app/views/events/image-reading/result.html #}

{% extends 'layout-reading.html' %}

{% set pageHeading = "Read images for " + participant | getFullName %}

{% set gridColumn = "nhsuk-grid-column-full" %}

{% set mainClasses = "nhsuk-u-padding-top-3" %}

{% set formAction = './reading-answer' %}

{% set tabActive = "imageReading" %}

{% block pageContent %}

  {{ participant | log("Participant") }}
  {{ event | log("Event") }}
  {{ data.readingSession | log("Reading session")}}
  {{ progress | log("Progress")}}

  {% set secondaryNavItems = [] %}

  {% set tabItems = [
    { id: 'imageReading', label: 'Reading assessment' },
    { id: 'participantDetails', label: 'Participant details' },
    { id: 'medicalInformation', label: 'Medical information' },
    { id: 'screeningHistory', label: 'Screening history' }
  ] %}

  {% for tab in tabItems %}
    {% set href -%}
      #
    {% endset %}
    {% set secondaryNavItems = secondaryNavItems | push({
      text: tab.label,
      href: href | trim,
      current: true if tabActive == tab.id
    }) %}
  {% endfor %}


  {{ appSecondaryNavigation({
    visuallyHiddenTitle: "Secondary menu",
    items: secondaryNavItems,
    classes: "nhsuk-u-margin-bottom-6"
  }) }}

  {# <span class="nhsuk-caption-l">
    {{ participant | getFullName }}
  </span> #}
  <h1 class="nhsuk-heading-l js-image-count">
    {{ pageHeading }}
  </h1>

  {# <p>Screened on 3 February 2025, 10:12am</p> #}

  {% set imageCount = event.mammogramData.metadata.totalImages %}
  {% set standardViews = event.mammogramData.views | length %}

  {# Only show if we have extra images #}
  {% if imageCount > standardViews %}
    {% set extraImagesHtml %}
      <ul class="nhsuk-list">
        {% for viewKey, viewData in event.mammogramData.views %}
          {% if viewData.images.length > 1 %}
            <li>
              {% if viewData.isRepeat %}
                {{ viewData.viewShortWithSide }} view was repeated because: {{ viewData.repeatReason }}
              {% else %}
                {{ viewData.viewShortWithSide }} view required additional images to capture the full breast
              {% endif %}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endset %}

    {{ warningCallout({
      heading: "Additional images",
      HTML: extraImagesHtml
    }) }}
  {% endif %}



  <h2>What is your assessment?</h2>

  <div class="form-group">
    {{ button({
      text: "Normal",
      href: eventId + "/confirm-normal"
    }) }}
  </div>
  <div class="form-group">
    {{ button({
      text: "Technical recall",
      classes: "nhsuk-button--secondary",
      href: eventId + "/recall-reason"
    }) }}
  </div>
  <div class="form-group">
    {{ button({
      "text": "Abnormal",
      "classes": "nhsuk-button--warning",
      href: eventId + "/awaiting-annotations"
    }) }}
  </div>

  {# <p><a href="#">Skip to next participant</a></p> #}

  {% if progress.hasNextUnread %}
    <p>
      <a href="/clinics/{{clinicId}}/reading/{{progress.nextUnreadId}}?skipped={{eventId}}" class="">Skip to next participant
      </a>
    </p>
  {% endif %}

  {% if progress.hasPrevious %}
    <p>
      <a href="/clinics/{{clinicId}}/reading/{{progress.previousEventId}}" class="">Previous participant
      </a>
    </p>

  {% endif %}

{% endblock %}


