{% set specialAppointmentRows = [] %}

{% if data.event.specialAppointment.supportTypes %}
  {% for supportType in data.event.specialAppointment.supportTypes %}
    {# Skip the _unchecked form artifact #}
    {% if supportType != '_unchecked' %}
      {% set details = "" %}
      {% set isTemporary = false %}
      
      {# Get the details for each support type #}
      {% if supportType == "Breast implants" and data.event.specialAppointment.implantDetails %}
        {% set details = data.event.specialAppointment.implantDetails %}
      {% elif supportType == "Vision" and data.event.specialAppointment.visionDetails %}
        {% set details = data.event.specialAppointment.visionDetails %}
      {% elif supportType == "Hearing" and data.event.specialAppointment.hearingDetails %}
        {% set details = data.event.specialAppointment.hearingDetails %}
      {% elif supportType == "Physical restriction" and data.event.specialAppointment.physicalRestrictionDetails %}
        {% set details = data.event.specialAppointment.physicalRestrictionDetails %}
      {% elif supportType == "Social, emotional, and mental health" and data.event.specialAppointment.socialEmotionalMentalHealthDetails %}
        {% set details = data.event.specialAppointment.socialEmotionalMentalHealthDetails %}
      {% elif supportType == "Language" and data.event.specialAppointment.languageDetails %}
        {% set details = data.event.specialAppointment.languageDetails %}
      {% elif supportType == "Gender identity" and data.event.specialAppointment.genderIdentityDetails %}
        {% set details = data.event.specialAppointment.genderIdentityDetails %}
      {% elif supportType == "Other" and data.event.specialAppointment.otherDetails %}
        {% set details = data.event.specialAppointment.otherDetails %}
      {% endif %}

      {# Check if this support type is temporary #}
      {% if data.event.specialAppointment.temporaryReasons == "yes" and data.event.specialAppointment.temporaryReasonsList %}
        {% for tempReason in data.event.specialAppointment.temporaryReasonsList %}
          {% if tempReason == supportType %}
            {% set isTemporary = true %}
          {% endif %}
        {% endfor %}
      {% endif %}

      {# Build the key content (support type + temporary tag if applicable) #}
      {% set keyContent = supportType %}
      {% if isTemporary %}
        {% set keyContent = keyContent + "<br><span class=\"nhsuk-tag nhsuk-tag--white\">Temporary</span>" %}
      {% endif %}

      {# Build the value content (details only) #}
      {% set valueContent = "" %}
      {% if details %}
        {% set valueContent = details %}
      {% else %}
        {% set valueContent = "<span style=\"color: var(--nhsuk-secondary-text-color);\">No details provided</span>" %}
      {% endif %}

      {# Add row for this support type #}
      {% set specialAppointmentRows = specialAppointmentRows | push({
        key: {
          html: keyContent,
          classes: "nhsuk-summary-list__key--wide"
        },
        value: {
          html: valueContent
        },
        actions: {
          items: [
            {
              href: eventUrl + "/special-appointments/edit" + ("?referrerChain=" + referrerChain if referrerChain),
              text: "Change",
              visuallyHiddenText: "special appointment requirements"
            }
          ]
        } if allowEdits and loop.first
      }) %}
    {% endif %}
  {% endfor %}
{% endif %}

{{ summaryList({
  rows: specialAppointmentRows,
  classes: "nhsuk-summary-list--no-border"
}) }}