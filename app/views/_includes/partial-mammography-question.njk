{# app/views/events/_includes/partial-mammography-question.njk #}

{# 
  Include for partial mammography question
  
  Parameters:
  - namePrefix: string - prefix for form field names (e.g., "event[mammogramData]" or "event[mammogramDataTemp]")
  - mammogramSource: object - object containing the mammogram data with values
#}

{% set reasonHtml %}

  {% set partialMammographyReasons = [
    "Consent withdrawn",
    "Language or learning difficulties",
    "Unable to scan tissue",
    "Positioning difficulties due to wheelchair",
    "Positioning difficulties for other mobility reasons",
    "Technical issues"
  ] %}

  {% set selectItems = [{
    value: "",
    text: "",
    selected: true,
    disabled: true,
    attributes: {
      style: "display:none;"
    }
  }] %}

  {% for item in partialMammographyReasons %}
    {% set selectItem = {
      value: item,
      text: item
    } %}
    {% set selectItems = selectItems | push(selectItem) %}
  {% endfor %}

  {{ select({
    id: "partialMammographyReasonSelect",
    name: namePrefix + "[partialMammographyReasonSelect]",
    label: {
      text: "Reason"
    },
    value: mammogramSource.partialMammographyReasonSelect,
    items: selectItems
  }) }}

  {% set rescheduleFreeText %}
    {{ textarea({
      name: namePrefix + "[partialMammographyReasonComment]",
      value: mammogramSource.partialMammographyReasonComment,
      id: "partialMammographyReasonComment",
      label: {
        text: "Follow-up appointment information"
      },
      hint: {
        text: "Provide information to help arrange the appointment and complete the mammogram"
      },
      rows: 3
    }) }}
  {% endset %}

  {{ checkboxes({
    idPrefix: "partialMammographyShouldReinvite",
    name: namePrefix + "[partialMammographyShouldReinvite]",
    values: mammogramSource.partialMammographyShouldReinvite,
    items: [
      {
        value: "yes",
        text: "Schedule another appointment to take more images",
        conditional: {
          html: rescheduleFreeText
        }
      }
    ]
  }) }}

{% endset %}

{{ checkboxes({
  idPrefix: "isPartialMammography",
  name: namePrefix + "[isPartialMammography]",
  values: mammogramSource.isPartialMammography,
  fieldset: {
    legend: {
      text: "Record as partial mammography?",
      classes: "nhsuk-fieldset__legend--m",
      isPageHeading: false
    }
  },
  items: [
    {
      value: "yes",
      text: "Yes, partial mammography",
      conditional: {
        html: reasonHtml
      }
    }
  ]
}) }}
