{# app/views/_includes/additional-image-details.njk #}

{# 
  Include for additional image details section
  
  Contains:
  - Incomplete mammography checkbox with reasons and follow-up questions
  - Imperfect but best possible images checkbox
  - Notes for reader textarea
  
  Parameters:
  - namePrefix: string - prefix for form field names (e.g., "event[mammogramData]" or "event[mammogramDataTemp]")
  - mammogramSource: object - object containing the mammogram data with values
#}

{% set reasonHtml %}

  {{ checkboxes({
    idPrefix: "incompleteMammographyReasons",
    name: namePrefix + "[incompleteMammographyReasons]",
    values: mammogramSource.incompleteMammographyReasons,
    fieldset: {
      legend: {
        text: "Why could you not take all the images?",
        classes: "nhsuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "Consent withdrawn",
        text: "Consent withdrawn"
      },
      {
        value: "Language or learning difficulties",
        text: "Language or learning difficulties"
      },
      {
        value: "Unable to scan tissue",
        text: "Unable to scan tissue",
        hint: {
          text: "For example, large breasts or implanted device"
        }
      },
      {
        value: "Positioning difficulties due to wheelchair",
        text: "Positioning difficulties due to wheelchair"
      },
      {
        value: "Positioning difficulties for other mobility reasons",
        text: "Positioning difficulties for other mobility reasons"
      },
      {
        value: "Technical issues",
        text: "Technical issues"
      },
      {
        divider: "or"
      },
      {
        value: "Other",
        text: "Other"
      }
    ]
  }) }}

  {{ textarea({
    name: namePrefix + "[incompleteMammographyReasonDetails]",
    value: mammogramSource.incompleteMammographyReasonDetails,
    id: "incompleteMammographyReasonDetails",
    label: {
      text: "Provide details (optional)"
    },
    rows: 2
  }) }}

  {% set yesRecallRescheduleDetailsHtml %}
    {{ textarea({
      name: namePrefix + "[incompleteMammographyFollowUpAppointmentDetails]",
      value: mammogramSource.incompleteMammographyFollowUpAppointmentDetails,
      id: "incompleteMammographyFollowUpAppointmentDetails",
      label: {
        text: "Note for scheduling recall appointment"
      },
      rows: 3
    }) }}
  {% endset %}

  {{ radios({
    idPrefix: "incompleteMammographyFollowUpAppointment",
    name: namePrefix + "[incompleteMammographyFollowUpAppointment]",
    value: mammogramSource.incompleteMammographyFollowUpAppointment,
    fieldset: {
      legend: {
        text: "Should the participant be recalled to take more images?",
        classes: "nhsuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "Yes, record as 'to be recalled'",
        text: "Yes, record as 'to be recalled'",
        conditional: {
          html: yesRecallRescheduleDetailsHtml
        }
      },
      {
        value: "No, record as 'partial mammography'",
        text: "No, record as 'partial mammography'"
      }
    ]
  }) }}

{% endset %}

{{ checkboxes({
  idPrefix: "isImperfectButBestPossible",
  name: namePrefix + "[isImperfectButBestPossible]",
  values: mammogramSource.isImperfectButBestPossible,
  items: [
    {
      value: "yes",
      text: "Imperfect, but best possible images",
      hint: {
        text: "Advise image readers not to request a technical recall"
      }
    }
  ]
}) }}

{{ checkboxes({
  idPrefix: "isIncompleteMammography",
  name: namePrefix + "[isIncompleteMammography]",
  values: mammogramSource.isIncompleteMammography,
  items: [
    {
      value: "yes",
      text: "Not all mammograms taken",
      conditional: {
        html: reasonHtml
      }
    }
  ]
}) }}

{{ textarea({
  name: namePrefix + "[notesForReader]",
  id: "notesForReader",
  value: mammogramSource.notesForReader,
  label: {
    text: "Notes for reader (optional)",
    classes: "nhsuk-label--s"
  },
  hint: {
    text: "Provide information for image readers when reviewing"
  },
  rows: 2
}) }}
