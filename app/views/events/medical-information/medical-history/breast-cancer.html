{# app/views/events/medical-information/medical-history/breast-cancer.html #}

{% extends 'layout-medical-history-form.html' %}

{% set pageHeading = "Breast cancer" %}
{% set medicalHistoryType = "breastCancer" %}

{% block formContent %}

{% call fieldset({
  legend: {
    text: "In which breast(s) has " + (participant.firstName or "the participant") + " had a cancer diagnosis?",
    classes: "nhsuk-fieldset__legend--m"
  }
}) %}

  <div class="nhsuk-hint">
    Include any breast cancer diagnosis including initial, recurring or secondary
  </div>
    
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-one-half">
      {{ checkboxes({
        name: "event[medicalHistoryTemp][breastLocation]",
        values: event.medicalHistoryTemp.breastLocation,
        items: [
          {
            value: "right",
            text: "Right breast"
          }
        ]
      }) }}
    </div>
    <div class="nhsuk-grid-column-one-half">
      {{ checkboxes({
        name: "event[medicalHistoryTemp][breastLocation]",
        values: event.medicalHistoryTemp.breastLocation,
        items: [
          {
            value: "left",
            text: "Left breast"
          }
        ]
      }) }}
    </div>
  </div>

  {{ checkboxes({
    name: "event[medicalHistoryTemp][breastLocation]",
    values: event.medicalHistoryTemp.breastLocation,
    items: [
      {
        divider: "or"
      },
      {
        value: "does-not-know",
        text: "Does not know"
      }
    ]
  }) }}

{% endcall %}

  {% call fieldset({
    legend: {
      text: "In what year was breast cancer first diagnosed?",
      classes: "nhsuk-fieldset__legend--m"
    }
  }) %}
    
    {{ input({
      name: "event[medicalHistoryTemp][diagnosisDate]",
      value: event.medicalHistoryTemp.diagnosisDate,
      id: "diagnosis-date",
      classes: "nhsuk-input--width-10",
      hint: {
        text: "For example, 2019"
      },
      pattern: "[0-9]*",
      inputmode: "numeric"
    }) }}

  {% endcall %}

  {% call fieldset({
    legend: {
      text: "What surgery have they had?",
      classes: "nhsuk-fieldset__legend--m"
    }
  }) %}
    
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-one-half">
        <h3 class="nhsuk-heading-s">Right breast (or axilla)</h3>
        {{ checkboxes({
          name: "event[medicalHistoryTemp][surgeryRightBreast]",
          values: event.medicalHistoryTemp.surgeryRightBreast,
          items: [
            {
              value: "full-mastectomy",
              text: "Full mastectomy"
            },
            {
              value: "lumpectomy",
              text: "Lumpectomy (or partial mastectomy)"
            },
            {
              value: "lymph-node-surgery",
              text: "Lymph node surgery"
            },
            {
              value: "reconstruction",
              text: "Reconstruction"
            },
            {
              value: "symmetrisation",
              text: "Symmetrisation"
            },
            {
              value: "no-surgery",
              text: "No surgery"
            }
          ]
        }) }}
      </div>
      <div class="nhsuk-grid-column-one-half">
        <h3 class="nhsuk-heading-s">Left breast (or axilla)</h3>
        {{ checkboxes({
          name: "event[medicalHistoryTemp][surgeryLeftBreast]",
          values: event.medicalHistoryTemp.surgeryLeftBreast,
          items: [
            {
              value: "full-mastectomy",
              text: "Full mastectomy"
            },
            {
              value: "lumpectomy",
              text: "Lumpectomy (or partial mastectomy)"
            },
            {
              value: "lymph-node-surgery",
              text: "Lymph node surgery"
            },
            {
              value: "reconstruction",
              text: "Reconstruction"
            },
            {
              value: "symmetrisation",
              text: "Symmetrisation"
            },
            {
              value: "no-surgery",
              text: "No surgery"
            }
          ]
        }) }}
      </div>
    </div>

  {% endcall %}

  {% call fieldset({
    legend: {
      text: "What treatment have they had?",
      classes: "nhsuk-fieldset__legend--m"
    }
  }) %}
    
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-one-half">
        <h3 class="nhsuk-heading-s">Right breast (or axilla)</h3>
        {{ checkboxes({
          name: "event[medicalHistoryTemp][treatmentRightBreast]",
          values: event.medicalHistoryTemp.treatmentRightBreast,
          items: [
            {
              value: "breast-radiotherapy",
              text: "Breast radiotherapy"
            },
            {
              value: "lymph-node-radiotherapy",
              text: "Lymph node radiotherapy"
            },
            {
              value: "no-radiotherapy",
              text: "No radiotherapy"
            }
          ]
        }) }}
      </div>

      <div class="nhsuk-grid-column-one-half">
        <h3 class="nhsuk-heading-s">Left breast (or axilla)</h3>
        {{ checkboxes({
          name: "event[medicalHistoryTemp][treatmentLeftBreast]",
          values: event.medicalHistoryTemp.treatmentLeftBreast,
          items: [
            {
              value: "breast-radiotherapy",
              text: "Breast radiotherapy"
            },
            {
              value: "lymph-node-radiotherapy",
              text: "Lymph node radiotherapy"
            },
            {
              value: "no-radiotherapy",
              text: "No radiotherapy"
            }
          ]
        }) }}
      </div>
    </div>

    <h3>Systemic treatments</h3>

    {{ checkboxes({
      name: "event[medicalHistoryTemp][systemicTreatments]",
      values: event.medicalHistoryTemp.systemicTreatments,
      items: [
        {
          value: "chemotherapy",
          text: "Chemotherapy"
        },
        {
          value: "hormone-therapy",
          text: "Hormone (endocrine) therapy"
        },
        {
          value: "targeted-therapy",
          text: "Targeted (biological) therapy"
        },
        {
          value: "bisphosphonates",
          text: "Bisphosphonates"
        },
        {
          value: "other",
          text: "Other"
        }
      ]
    }) }}

  {% endcall %}

  {{ radios({
    name: "event[medicalHistoryTemp][treatmentLocation]",
    value: event.medicalHistoryTemp.treatmentLocation,
    fieldset: {
      legend: {
        text: "Where did surgery and treatment take place?",
        classes: "nhsuk-fieldset__legend--m"
      }
    },
    items: [
        {
          value: "nhs-hospital",
          text: "At an NHS hospital",
          conditional: {
            html: '<div id="nhs-hospital-autocomplete">
              <label class="nhsuk-label" for="nhs-hospital-search">
                Type to search locations
              </label>
              <input class="nhsuk-input" id="nhs-hospital-search" name="event[medicalHistoryTemp][nhsHospitalName]" type="text" value="' + (event.medicalHistoryTemp.nhsHospitalName or '') + '">
            </div>'
          }
        },
        {
          value: "private-hospital",
          text: "At a private hospital in the UK",
          conditional: {
            html: input({
              name: "event[medicalHistoryTemp][privateHospitalDetails]",
              value: event.medicalHistoryTemp.privateHospitalDetails,
              id: "private-hospital-details",
              label: {
                text: "Provide details"
              }
            })
          }
        },
        {
          value: "outside-uk",
          text: "Outside the UK",
          conditional: {
            html: input({
              name: "event[medicalHistoryTemp][outsideUkDetails]",
              value: event.medicalHistoryTemp.outsideUkDetails,
              id: "outside-uk-details",
              label: {
                text: "Provide details"
              }
            })
          }
        },
        {
          value: "multiple-locations",
          text: "At more than one location",
          conditional: {
            html: textarea({
              name: "event[medicalHistoryTemp][multipleLocationsDetails]",
              value: event.medicalHistoryTemp.multipleLocationsDetails,
              id: "multiple-locations-details",
              label: {
                text: "Provide details of locations"
              },
              rows: 4
            })
          }
        },
        {
          value: "unknown",
          text: "Exact location unknown",
          conditional: {
            html: input({
              name: "event[medicalHistoryTemp][unknownLocationDetails]",
              value: event.medicalHistoryTemp.unknownLocationDetails,
              id: "unknown-location-details",
              label: {
                text: "Provide details"
              }
            })
          }
        }
      ]
    }) }}

  {{ textarea({
    name: "event[medicalHistoryTemp][additionalInfo]",
    value: event.medicalHistoryTemp.additionalInfo,
    id: "additional-info",
    label: {
      text: "Additional info (optional)",
      classes: "nhsuk-label--m"
    },
    rows: 4
  }) }}

{% endblock formContent %}

{% block pageScripts %}
  <script>
    // Initialize accessible autocomplete for NHS hospitals when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Check if accessible autocomplete is available
      if (typeof accessibleAutocomplete !== 'undefined') {
        // Sample NHS hospital data - in real implementation this would come from an API
        const nhsHospitals = [
          'Royal Free Hospital',
          'Guy\'s Hospital', 
          'St Thomas\' Hospital',
          'King\'s College Hospital',
          'University College Hospital',
          'Royal Marsden Hospital',
          'Barts Health NHS Trust',
          'Imperial College Healthcare'
        ]

        const nhsHospitalInput = document.querySelector('#nhs-hospital-search')
        if (nhsHospitalInput) {
          accessibleAutocomplete.enhanceSelectElement({
            selectElement: null,
            source: nhsHospitals,
            defaultValue: nhsHospitalInput.value,
            onConfirm: function(option) {
              nhsHospitalInput.value = option
            }
          })
        }
      }
    })
  </script>
{% endblock pageScripts %}