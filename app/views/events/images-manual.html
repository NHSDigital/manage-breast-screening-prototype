{% extends 'layout-appointment.html' %}

{% set showNavigation = true %}
{% set hideBackLink = true %}
{% set activeWorkflowStep = 'take-images' %}

{% set pageHeading = "Record images taken" %}

{% set gridColumn = "nhsuk-grid-column-two-thirds" %}

{% set formAction = './images-manual-answer' %}

{% set activeTab = 'images' %}

{% block pageContent %}

  <h1>{{ pageHeading }}</h1>

  {% set mammogramSource = event.mammogramDataTemp or event.mammogramData %}

  {# Determine current room name #}
  {% set currentRoomName = "" %}
  {% set isMobileClinic = (clinic.location.type == 'mobile_unit') %}
  
  {% if isMobileClinic %}
    {# For mobile clinics, use the mobile unit name #}
    {% set currentRoomName = clinic.location.name %}
  {% else %}
    {# For hospital clinics, look up the room from screening rooms #}
    {% for room in data.screeningRooms %}
      {% if room.id == data.currentScreeningRoom %}
        {% set currentRoomName = room.displayName %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {% if currentRoomName %}
    <p>
      Mammogram location: <span class="nhsuk-u-font-weight-bold">{{ currentRoomName }}</span>.
      {% if not isMobileClinic %}
        <br><a href="{{ './images-room-selection' | urlWithReferrer(referrerChain) }}">Change room or machine details</a>
      {% endif %}
    </p>

    {{ appHiddenInput({
      name: "event[mammogramDataTemp][machineRoom]",
      value: currentRoomName
    }) }}
  {% else %}
    <p>
      <a href="{{ './images-room-selection' | urlWithReferrer(referrerChain) }}">Select a room before continuing</a>
    </p>
  {% endif %}

  {# {{ radios({
    name: "event[mammogramDataTemp][machineRoom]",
    value: mammogramSource.machineRoom,
    idPrefix: "machineRoom",
    fieldset: {
      legend: {
        text: "Which room is imaging being done in?",
        classes: "nhsuk-fieldset__legend--m",
        isPageHeading: false
      }
    },
    items: [
      {
        value: "Room A - machine XYZ",
        text: "Room A - machine XYZ"
      },
      {
        value: "Room B - machine ABC",
        text: "Room B - machine ABC"
      },
      {
        value: "Room C - machine DEF",
        text: "Room C - machine DEF"
      }
    ]
  }) }} #}

  {{ radios({
    idPrefix: "imagingComplete",
    name: "event[mammogramDataTemp][isStandardSet]",
    fieldset: {
      legend: {
        text: "Have you taken a standard set of images?",
        classes: "nhsuk-fieldset__legend--m",
        isPageHeading: false
      }
    },
    value: mammogramSource.isStandardSet,
    items: [
      {
        value: "yes",
        text: "Yes, 2 CC and 2 MLO"
      },
      {
        value: "custom",
        text: "No, add additional image or partial mammogram details"
      },
      {
        divider: "or"
      },
      {
        value: "no",
        text: "No images taken",
        hint: {
          text: "The appointment cannot proceed"
        }
      }
    ]
  }) }}

  {{ button({
    text: "Continue"
  }) }}

{% endblock %}