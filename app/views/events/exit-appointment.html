{# app/views/events/exit-appointment.html #}

{% extends 'layout-appointment.html' %}

{% set pageHeading = "Exit appointment" %}
{% set formAction = eventUrl + "/exit-appointment-answer" %}

{% block pageContent %}

  <h1 class="nhsuk-heading-l">{{ pageHeading }}</h1>

  {% set hasStartedImaging = event.workflowStatus['confirm-identity'] and event.workflowStatus['review-medical-information'] %}
  {% set hasCompletedImaging = event.workflowStatus['take-images'] %}

  {% if hasStartedImaging and not hasCompletedImaging %}
    {# User is ready for imaging but hasn't completed it yet - ask if images were taken #}
    {{ radios({
      name: "imagesTaken",
      fieldset: {
        legend: {
          text: "Have you taken any mammogram images of " + (participant | getFullName) + " during this appointment?",
          classes: "nhsuk-fieldset__legend--m",
          isPageHeading: false
        }
      },
      items: [
        {
          value: "Yes",
          text: "Yes"
        },
        {
          value: "No",
          text: "No"
        }
      ]
    }) }}

    <div class="nhsuk-button-group">
      {{ button({
        text: "Continue"
      }) }}

      <a href="{{ eventUrl | getReturnUrl(referrerChain) }}" class="nhsuk-link nhsuk-link--no-visited-state">Cancel</a>
    </div>

  {% else %}
    {# Before imaging phase - show options to save/discard/cannot proceed #}
    {{ radios({
      name: "exitAction",
      fieldset: {
        legend: {
          text: "Will this appointment be resumed today?",
          classes: "nhsuk-fieldset__legend--m",
          isPageHeading: false
        }
      },
      items: [
        {
          value: "save",
          text: "Yes, pause and save changes"
        },
        {
          value: "cannot-proceed",
          text: "No, appointment cannot proceed"
        },
        {
          divider: "or"
        },
        {
          value: "discard",
          text: "Discard changes and revert status to 'Checked in'"
        }
      ]
    }) }}

    <div class="nhsuk-button-group">
      {{ button({
        text: "Confirm"
      }) }}

      <a href="{{ eventUrl | getReturnUrl(referrerChain) }}" class="nhsuk-link nhsuk-link--no-visited-state">Cancel</a>
    </div>

  {% endif %}

{% endblock %}